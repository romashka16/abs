# MFA (Montreal Forced Aligner) –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

## –ß—Ç–æ —Ç–∞–∫–æ–µ MFA?

Montreal Forced Aligner (MFA) - —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –∞—É–¥–∏–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–ª–æ–≤. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å—É–±—Ç–∏—Ç—Ä—ã —Å —Ç–æ—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ —Å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ–º.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ MFA

- üéØ **–¢–æ—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ —Ç–æ—á–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –º–æ–º–µ–Ω—Ç—É –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏—è
- üöÄ **–õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ** - —Å—É–±—Ç–∏—Ç—Ä—ã –≤—ã–≥–ª—è–¥—è—Ç –±–æ–ª–µ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ
- üìà **–£–ª—É—á—à–µ–Ω–Ω—ã–π UX** - –∑—Ä–∏—Ç–µ–ª–∏ –ª—É—á—à–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –∫–æ–Ω—Ç–µ–Ω—Ç

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ MFA

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Montreal Forced Aligner

```bash
pip install montreal-forced-aligner
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
mfa --version
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```bash
python test_mfa.py
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í —Ñ–∞–π–ª–µ `config.py` –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã MFA:

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MFA –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —Å–ª–æ–≤
USE_MFA_ALIGNMENT = True

# Fallback –Ω–∞ –æ–±—ã—á–Ω—ã–µ —Å—É–±—Ç–∏—Ç—Ä—ã –µ—Å–ª–∏ MFA –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
MFA_FALLBACK_TO_NORMAL = True

# –û—á–∏—â–∞—Ç—å MFA –∫–æ—Ä–ø—É—Å –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
CLEAN_MFA_CORPUS = True

# –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è MFA –ø—Ä–æ—Ü–µ—Å—Å–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
MFA_TIMEOUT = 300  # 5 –º–∏–Ω—É—Ç
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

MFA –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ. –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
python main.py
```

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MFA –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
2. –ï—Å–ª–∏ MFA –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω—ã–µ —Å—É–±—Ç–∏—Ç—Ä—ã (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω fallback)
3. –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –†—É—á–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from mfa_align import process_with_mfa

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ
success = process_with_mfa(
    audio_path="path/to/audio.wav",
    srt_path="path/to/subtitles.srt", 
    video_name="video_name",
    output_ass_path="path/to/output.ass"
)

if success:
    print("MFA –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–∞!")
else:
    print("MFA –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±—ã—á–Ω—ã–µ —Å—É–±—Ç–∏—Ç—Ä—ã")
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
project_root/
‚îú‚îÄ‚îÄ russian/
‚îÇ   ‚îú‚îÄ‚îÄ russian_cv.dict          # –†—É—Å—Å–∫–∏–π —Å–ª–æ–≤–∞—Ä—å
‚îÇ   ‚îú‚îÄ‚îÄ russian_mfa.dict         # MFA —Å–ª–æ–≤–∞—Ä—å
‚îÇ   ‚îî‚îÄ‚îÄ russian_mfa/             # –ú–æ–¥–µ–ª–∏ MFA
‚îÇ       ‚îú‚îÄ‚îÄ final.mdl
‚îÇ       ‚îú‚îÄ‚îÄ graphemes.txt
‚îÇ       ‚îú‚îÄ‚îÄ phones.txt
‚îÇ       ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ mfa_data/                    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ MFA
‚îÇ   ‚îú‚îÄ‚îÄ corpus/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ txts/               # –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wavs/               # –ê—É–¥–∏–æ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ output/                 # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ mfa_align.py                # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å MFA
‚îî‚îÄ‚îÄ test_mfa.py                 # –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
```

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã MFA

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ—Ä–ø—É—Å–∞**
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –∏–∑ –≤–∏–¥–µ–æ
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–∑ SRT —Å—É–±—Ç–∏—Ç—Ä–æ–≤
   - –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ MFA

2. **–í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ**
   - –ó–∞–ø—É—Å–∫ MFA —Å —Ä—É—Å—Å–∫–æ–π –º–æ–¥–µ–ª—å—é
   - –°–æ–∑–¥–∞–Ω–∏–µ TextGrid —Ñ–∞–π–ª–∞ —Å —Ç–æ—á–Ω—ã–º–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏

3. **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è**
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ TextGrid –≤ ASS —Å—É–±—Ç–∏—Ç—Ä—ã
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ TikTok —Å—Ç–∏–ª—è

4. **–û—á–∏—Å—Ç–∫–∞**
   - –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### MFA –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```bash
pip install montreal-forced-aligner
```

### –û—à–∏–±–∫–∞ "MFA –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É: `mfa --version`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Python –≤ PATH
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª

### –û—à–∏–±–∫–∞ "TextGrid —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ä—É—Å—Å–∫–æ–π –º–æ–¥–µ–ª–∏ –≤ `russian/russian_mfa/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞—É–¥–∏–æ —Ñ–∞–π–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–ø–∫–∞–º

### MFA —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ
1. –£–≤–µ–ª–∏—á—å—Ç–µ `MFA_TIMEOUT` –≤ config.py
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –º–æ—â–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
3. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –≤–∏–¥–µ–æ

### Fallback –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `MFA_FALLBACK_TO_NORMAL = True`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–¥—É–ª—å `subtitles.py`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

## –û—Ç–∫–ª—é—á–µ–Ω–∏–µ MFA

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—ã—á–Ω—ã–µ —Å—É–±—Ç–∏—Ç—Ä—ã:

```python
# –í config.py
USE_MFA_ALIGNMENT = False
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

MFA –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å:
- üéØ –°—Ç–∞—Ç—É—Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- ‚ùå –û—à–∏–±–∫–∏
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ö–æ—Ä–æ—Ç–∫–∏–µ –≤–∏–¥–µ–æ** (< 1 –º–∏–Ω): ~30-60 —Å–µ–∫
- **–°—Ä–µ–¥–Ω–∏–µ –≤–∏–¥–µ–æ** (1-5 –º–∏–Ω): ~2-5 –º–∏–Ω  
- **–î–ª–∏–Ω–Ω—ã–µ –≤–∏–¥–µ–æ** (> 5 –º–∏–Ω): ~5-15 –º–∏–Ω

–í—Ä–µ–º—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ–æ
- –ö–∞—á–µ—Å—Ç–≤–∞ –∞—É–¥–∏–æ
- –ú–æ—â–Ω–æ—Å—Ç–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ—á–∏ 